<?php
/**
 * User: JiaJia.Lee
 * Date: 14-5-3
 * Time: ä¸Šåˆ3:22
 */

namespace Util;

use Phalcon\Queue\Beanstalk;

final class BStalkClient {

    private $host = '';

    private $port = 0;

    private static $beans = null;

    private function __construct() {}
    private function __clone(){}

    public static function getInstance($di, $queueName='link_queue0') {
        if(!isset(self::$beans[$queueName])) {
            $self = new self;
            $self->host = ReadConfig::get(sprintf('beanstalk.%s.host', $queueName), $di);
            $self->port = ReadConfig::get(sprintf('beanstalk.%s.port', $queueName), $di);
            self::$beans[$queueName] = $self->_init();
        }
        return self::$beans[$queueName];
    }

    private function _init() {
        try {
            $bean = new Beanstalk(array(
                'host'=>$this->host,
                'port'=>$this->port
            ));
            $bean->connect();
            return $bean;
        } catch(Exception $e) {
            echo $e->getMessage();
        }
    }

}